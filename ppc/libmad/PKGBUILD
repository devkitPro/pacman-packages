# Maintainer: Dave Murphy <davem@devkitpro.org>
# Contributor: Ash Logan <ash [at] heyquark [dot] com>

pkgname=ppc-libmad
pkgver=0.15.1b
pkgrel=1
pkgdesc="High-quality MPEG audio decoder"
url="https://www.underbit.com/products/mad/"
license=("GPLv2")
arch=("any")
depends=("devkitPPC")
makedepends=("ppc-pkg-config" "devkitpro-pkgbuild-helpers")
options=("!buildflags" "staticlibs" "libtool" "!strip")
source=("ftp://ftp.mars.org/pub/mpeg/libmad-${pkgver}.tar.gz"
        "frame_length.patch" "pkg-config.patch" "optimise.diff")
sha256sums=("bbfac3ed6bfbc2823d3775ebb931087371e142bb0e9bb1bee51a76a6e0078690"
            "e54439c7efa6fc7272923d8507d79ee2992b115225baed1c47d1704e442e3c24"
            "1616cddc2b5f0700ad65605fe826c0d21ed3f0892f214e9ff895d947346d1d36"
            "269505f22d700f3f00bcc97706f75889fbc6f7acf99cf068f0939b287bb50966")

prepare() {
    cd libmad-$pkgver

    patch -p1 -i "$srcdir/pkg-config.patch"
    patch -p1 -i "$srcdir/frame_length.patch"
    patch -p1 -i "$srcdir/optimise.diff"
}

build() {
    cd libmad-$pkgver
    source /opt/devkitpro/ppcvars.sh

    # We changed configure.ac above
    touch NEWS AUTHORS ChangeLog
    autoconf

    ./configure --prefix="$PORTLIBS_PREFIX" --host=powerpc-eabi --disable-shared

    make
}

package() {
    cd libmad-$pkgver
    source /opt/devkitpro/ppcvars.sh

    make DESTDIR="$pkgdir" install

    install -Dm644 COPYRIGHT "$pkgdir/$PORTLIBS_PREFIX/licenses/$pkgname/COPYRIGHT"
}
