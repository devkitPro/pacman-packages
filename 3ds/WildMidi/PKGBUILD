# Maintainer: WinterMute <davem@devkitpro.org>

pkgname=3ds-wildmidi
pkgver=0.4.2
pkgrel=1
pkgdesc='Core softsynth library that can be used with other applications.'
arch=('any')
url='https://www.mindwerks.net/projects/wildmidi/'
license=('LGPL')
options=(!strip libtool staticlibs)
source=( "https://github.com/Mindwerks/wildmidi/archive/wildmidi-${pkgver}.tar.gz" "wildmidi-0.4.2.patch")
makedepends=('devkitpro-pkgbuild-helpers')
sha256sums=(
'551d43cb6de6019885f933a20b6f3205a92814f50da8b0d8bceac002b9a8109d'
'7ecc933998a833763dc9f4790c8614f0247f02a9607ee74b966d30814e1a1a19')

build() {
  cd wildmidi-wildmidi-$pkgver

  source /opt/devkitpro/3dsvars.sh

  patch -p1 -i $srcdir/wildmidi-0.4.2.patch

  cmake . -DCMAKE_TOOLCHAIN_FILE=/opt/devkitpro/3ds.cmake \
    -DCMAKE_INSTALL_PREFIX=$PORTLIBS_PREFIX \
    -DCMAKE_C_FLAGS="$CFLAGS $CPPFLAGS" \
    -DWANT_PLAYER=OFF -DWANT_STATIC=ON \
    -DBUILD_SHARED_LIBS=OFF -DCMAKE_BUILD_TYPE=RelWithDebInfo \
    -G"Unix Makefiles"

  make

}

package() {

  cd wildmidi-wildmidi-$pkgver

  source /opt/devkitpro/3dsvars.sh

  make DESTDIR="$pkgdir" install

}
